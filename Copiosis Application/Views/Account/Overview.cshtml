@model Copiosis_Application.Models.TransactionOverviewModel
<div class="row">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="col-lg-8 col-md-7 col-sm-5 col-xs-12"style="padding-left:0px">
                <h1>Transaction Overview</h1>
            </div>
            <div class="col-lg-4 col-md-5 col-sm-7 col-xs-12">
                <h4 class="text-center">Create a Transaction</h4>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center" style="margin-top:5px">
                    <button type="button" class="btn btn-default" onclick="location.href='@Url.Action("Create", "Account", new { type = "producer" })'">I Benefited Someone</button>
                    <button type="button" class="btn btn-default" onclick="location.href='@Url.Action("Create", "Account", new { type = "consumer" })'">I Received Benefit</button>
                </div>
            </div>
        </div>
    </div>    
    <div class="row">
        <div class="col2-sm-12 col-md-12 col-lg-12">
            <h3>Transactions Awaiting Your Approval</h3>

            @if (Model.pendingUser.Count() < 1) { 
                <h4>No Pending Personal Transactions</h4>
            }
            else { 
                <div class="table-responsive">
                    <table data-link="row" class="table table-bordered table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Service/Item Name</th>
                                <th>Gateway</th>
                                <th>Date Created</th>
                                <th>Other Party</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.pendingUser)
                            {
                                if(item.newSinceLogin)
                                {
                                    <tr id="@item.productGuid" class="clickable" onclick="location.href='@Url.Action("View", "Account", new { tranId = item.transactionID })' " style="background-color: #F4FA58;cursor:pointer">
                                        <td> <span class="glyphicon glyphicon-flag"></span> @item.productName </td>
                                        <td>@item.productGateway</td>
                                        <td>@item.dateAdded</td>
                                        <td>@item.otherParty</td>                                        
                                    </tr>
                                }
                                else { 
                                    <tr id="@item.productGuid" class="clickable" onclick="location.href='@Url.Action("View", "Account", new { tranId = item.transactionID })' " style="cursor:pointer">
                                        <td>@item.productName</td>
                                        <td>@item.productGateway</td>
                                        <td>@item.dateAdded</td>
                                        <td>@item.otherParty</td>                                        
                                    </tr>
                                }
                            }
                        </tbody> 
                    </table>
                </div>
            }
        </div>
    </div>
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <h3>Transactions Awaiting Other Parties Approval</h3>
                @if (Model.pendingOther.Count() < 1)
                {
                    <h4>No Pending Requested Transactions</h4>
                }
                else
                {
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover table-striped">
                            <thead>
                                <tr>
                                    <th>Service/Item Name</th>
                                    <th>Gateway</th>
                                    <th>Date Created</th>
                                    <th>Other Party</th>                                    
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.pendingOther)
                                {                                
                                    <tr id="@item.productGuid" class="clickable" onclick="location.href='@Url.Action("View", "Account", new { tranId = item.transactionID })' " style="cursor:pointer">
                                        <td>@item.productName</td>
                                        <td>@item.productGateway</td>
                                        <td>@item.dateAdded</td>
                                        <td>@item.otherParty</td>                                        
                                    </tr>                        
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>

        </div>
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <h3>Completed Transactions</h3>
            @if (Model.completed.Count() < 1)
            {
                <h4>No Recently Completed Transactions</h4>
            }
            else { 
                <div class="table-responsive">
                    <table class="table table-bordered table-hover table-striped">
                        <thead>
                            <tr>
                                <th class="clickable" onclick="modifyView('product')">Service/Item Name</th>
                                <!-- <th>Date Created</th> -->
                                <th class="clickable" onclick="modifyView('date')">Date Completed</th>
                                <th class="clickable" onclick="modifyView('otherParty')">Other Party</th>
                                <th class="clickable" onclick="modifyView('nbr')">NBR Change</th>
                                <th class="clickable" onclick="modifyView('status')">Result</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.completed)
                            {
                                if (item.isProducer == true && item.status == "Confirmed")
                                {
                                    <tr id="@item.productGuid" class="clickable" onclick="location.href='@Url.Action("View", "Account", new { tranId = item.transactionID })'" style="cursor:pointer">
                                        <td>@item.productName</td>
                                        <!-- <td>@item.dateAdded</td> -->
                                        <td>@item.dateClosed</td>
                                        <td>@item.otherParty</td>
                                        <td class="greenText bold">+@(item.nbr +2)</td>
                                        <td class="greenText">@item.status</td>
                                    </tr>
                                }
                                else if (item.isProducer == false && item.status == "Confirmed")
                                {
                                    <tr id="@item.productGuid" class="clickable" onclick="location.href='@Url.Action("View", "Account", new { tranId = item.transactionID })'" style="cursor:pointer">
                                        <td>@item.productName</td>
                                        <!-- <td>@item.dateAdded</td> -->
                                        <td>@item.dateClosed</td>
                                        <td>@item.otherParty</td>
                                        @if (item.nbr > 2)
                                        {
                                            <td class="redText">-@(item.nbr - 2)</td>
                                        }
                                        else if (item.nbr == 2)
                                        {
                                            <td>0</td>
                                        }
                                        else if (item.nbr == 1)
                                        {
                                            <td class="greenText bold">+@(item.nbr)</td>
                                        }
                                        else if (item.productGateway == 0)
                                        {
                                            <td class="greenText bold">+2</td>
                                        }
                                        <td class="greenText">@item.status</td>
                                    </tr>
                                }
                                else 
                                {
                                    <tr id="@item.productGuid" class="clickable" onclick="location.href='@Url.Action("View", "Account", new { tranId = item.transactionID })'" style="cursor:pointer">
                                        <td>@item.productName</td>
                                        <!-- <td>@item.dateAdded</td> -->
                                        <td>@item.dateClosed</td>
                                        <td>@item.otherParty</td>
                                        <td>N/A</td>
                                        <td class="redText">@item.status</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>

<script type="text/javascript">
    lastSort = getURLParameter("qSort") == null ? "date" : getURLParameter("qSort");
    lastOrder = getURLParameter("qOrder") == null ? "Desc" : getURLParameter("qOrder");

    function modifyView(column)
    {
        if (column == lastSort)
        {
            lastOrder = (lastOrder == "Desc") ? "Asc" : "Desc";
            addr = '/Account/Overview?qSort=' + lastSort + '&qOrder=' + lastOrder;
            location.href = addr;
        }
        else
        {
            lastSort = column;
            addr = '/Account/Overview?qSort=' + lastSort + '&qOrder=' + lastOrder;
            location.href = '/Account/Overview?qSort='+lastSort+'&qOrder='+lastOrder;
        }
    }

    function getURLParameter(name)
    {
        var url = window.location.search.substring(1);
        var vars = url.split('&');
        for (var i = 0; i < vars.length; i++)
        {
            var paramName = vars[i].split('=');
            if (paramName[0] == name)
                return paramName[1];
        }
        return null;
    }
</script>